---
title: 'SCOTI simulation-seabird Norwegian example'
author: "Based on SCOTI scripts (multiple authors)"
date: "14/11/23"
output: html_document
---

```{r, echo=FALSE}
knitr::opts_chunk$set(tidy=TRUE, dpi=150)
```

## Parametrization for a seabird example

The current example is based on data from the Reference fleet in Norway (IMR). More information on The Norwegian Reference Fleet can be found [here](https://hdl.handle.net/11250/2685855). In this particular case we consider bycatch of Northern fulmars (*Fulmarus glacialis*) in a sample of the offshore longline fishery where we have high confidence in that the reported numbers are close to actual numbers of bycatch.

It is still worth keeping in mind, however, that the observed probabilities of bycatch events and number of individuals bycaught per event could be biased values (e.g., already including an observation error that might might shape those parameters).

First we start by sourcing all needed functions from the github repository

```{r,warning=FALSE,message=FALSE,echo=TRUE,results='hide',eval=FALSE}

source("https://raw.githubusercontent.com/dlusseau/scoti/main/estimate_fishing_effort_metier.R")
source("https://raw.githubusercontent.com/dlusseau/scoti/main/heterogeneity_stats_distributions.r")
source("https://raw.githubusercontent.com/dlusseau/scoti/main/make_fishing_year_metier.r")
source("https://raw.githubusercontent.com/dlusseau/scoti/main/monitor_BPUE_metier.R")
```

## Simulating fishery data

Secondly, we use the `make_fishing_year_metier()` function to simulate the fishery in the case study. The first parameter (`nboat`) is the size of the active fishing fleet, which is 28 longliner vessels. The next parameter controls the mean number of fishing events per boat day. In this case study vessel is the primary sampling unit, and we assume that one day at sea equals one haul (i.e., mean fishing event per boat day is one). The data represent one metier (L4, LLF_DES_0_0_0), so the probability of recording at one metier is set to one.

The next couple of parameters concerns the probability of a bycatch event: The mean number of birds taken given an event, as well as the potential of more extreme events (probability of a large bycatch event as well as the mean number of individuals taken in those events). In the data there are signs of bycatch following a bimodial distribution, in the sense that we have some rare events with a much higher number (N~max~=36) than the estimated mean bycatch (\~2). The probability of a large event, as well as the number of birds captured in these events are however rather uncertain as they are indeed rare events in the data. So, these parameters could be considered a mixture between data driven and more qualitatively driven (based on informal communication with fishers). In the data, there are unexplained variation between vessels in reported bycatch numbers, i.e. a vessel effect of bycatch which might be attributed to a number of different variables in reality (training, mitigation measures, spatio-temporal variation in fishing etc).

To account for non-independence of repeated sampling by vessels, we introduced additional variation in bycatches across vessels after bycatch observations were generated. This was done by adding random noise to the final estimate with \mu = 0 and \theta defined as an additional parameter in the simulation (named `vessel.effect`). To ensure the additional variation didn't generate negative values, we applied it to log-transformed observations before back-transforming to the original scale.

```{r,warning=FALSE,message=FALSE,echo=TRUE,results='hide',eval=FALSE}

# Simulate the true state of the fishery
nboat <- 28
mean.fishing.event.boat.day <- 1
p.metier <- 1
p.bycatch <- 0.12 # range is from 0.02 to 0.12
p.large.event <- 0.007
mean.bycatch.event <- 2 # (rounded down from 2.4)
mean.bycatch.large.event <- 36 # max in dataset is 36 
stochastic <- FALSE
BPUE_real = sum(fishing$nbycatch) / dim(fishing)[1]

```

## Simulating monitoring

We don't have any actual data to calculate detection probability of individual birds in the catch, but we use a fixed probability [0.7](https://doi.org/10.1371/journal.pone.0220797) based on similar fisheries in the literature. We thus assume that some we don't have any information that this is likely to vary in time or space. The 'refusal rate' is assumed to be zero, as these values represent a reference fleet.

```{r,warning=FALSE,message=FALSE,echo=TRUE,results='hide',eval=FALSE}
# Simulate monitoring
pmonitor <- 1
nsample <- 100 # How many times to run - this is independent of the fishery, it's just how many draws you want to do.
p_monitor_boat <- 3/31 #  n boats that were willing to report seabirds
boat_samp <- TRUE
p_haul_obs <- 1 # should be fixed at 1 per David
detect_prob <- 0.7
refusal_rate <- 0 # ignoring refusal for now
misclassification <- 0
bymetier <- FALSE
p_monitor_metier <- 1



```
